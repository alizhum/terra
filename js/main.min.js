const counters = document.querySelectorAll('.counter-item');
const speed = 100;
const abroadAddress = document.querySelectorAll('.abroad__address-tag');
const abroadAddressClose = document.querySelectorAll('.abroad__address-box-close');
const viewButtons = document.querySelectorAll('.view-button');
const navToggle = document.getElementById('nav-toggle');
const headerMobile = document.getElementById('header-mobile');
const submenuToggle = document.querySelectorAll('.header__nav-item-toggle');
const courseProgramToggleButtons = document.querySelectorAll('.course__program-item-header');
const filterItemsToggle = document.querySelectorAll('.filter-form__toggle-items');
const filterToggle = document.querySelector('.filter-toggle');
const filterClose = document.querySelector('.filter-form__close');
const caseCatsExpand = document.querySelector('.case-cats__list-expand');
const formDateItems = document.querySelectorAll('.form__date');

customSelect();
rangeSliderInit();
modalInit();
tabsInit();
faqInit();
initializeQuiz();

formDateItems?.forEach((item) => {
  
  const toggleButton = item.querySelector('.form__date-toggle');
  const calendarContainer = item.querySelector('.form__date-calendar');
  const currentDate = toggleButton.querySelector('span');

  if( calendarContainer ) {
    
    const options = {
        settings: {
          lang: 'ru',
        },
        actions: {
          clickDay(event, self) {
            let date = new Date(self.selectedDates);
            setCurrentDate(date, currentDate);
          },
          initCalendar(self) {
            setCurrentDate(self.date.today, currentDate);
          },
      },
    };

    const calendar = new VanillaCalendar('.form__date-calendar', options);
    calendar.init();

    

    
    toggleButton.addEventListener('click', function(event) {
      event.stopPropagation();
      calendarContainer.classList.toggle('active');
    });

      document.addEventListener('click', function(event) {
          if (!calendarContainer.contains(event.target) && !toggleButton.contains(event.target)) {
              calendarContainer.classList.remove('active');
          }
      });

      calendarContainer.addEventListener('click', function(event) {
          event.stopPropagation();
      });

      function setCurrentDate(dateObject, element) {
        const day = String(dateObject.getDate()).padStart(2, '0');
        const month = String(dateObject.getMonth() + 1).padStart(2, '0'); // Прибавляем 1, так как месяцы в JavaScript нумеруются с 0
        const year = dateObject.getFullYear();
        let formattedDate = `${day}.${month}.${year}`;

        element.textContent = formattedDate;

      }

  }

});

caseCatsExpand?.addEventListener('click', function() {
  
  this.closest('.case-cats__list').classList.toggle('case-cats__list--expanded');
  const buttonText = this.querySelector('span');
  const defaultText = this.getAttribute('data-default-text');
  const expandedText = this.getAttribute('data-expanded-text');
  let isExpanded = this.closest('.case-cats__list').classList.contains('case-cats__list--expanded');

  if (isExpanded) {
      buttonText.textContent = expandedText;
  } else {
      buttonText.textContent = defaultText;
  }

});

// Filter
filterItemsToggle?.forEach((button) => {
  button.addEventListener('click', function() {
    
    const parent = this.closest('.filter-form__item');
    const hiddenItems = parent.querySelectorAll('.filter-form__field--hidden');
    const toggledText = this.getAttribute('data-toggled-text');
    const defaultText = this.getAttribute('data-default-text');

    hiddenItems.forEach(function(item) {
      item.classList.toggle('filter-form__field--show')
    });

    if (parent.querySelector('.filter-form__field--show')) {
      // Если есть скрытые элементы, меняем текст кнопки на значение атрибута data-toggled-text
      this.querySelector('span').textContent = toggledText;
    } else {
        // Если нет скрытых элементов, меняем текст кнопки на значение атрибута data-default-text
        this.querySelector('span').textContent = defaultText;
    }


  });
});


filterToggle?.addEventListener('click', function() {
    document.querySelector('.filter-form').classList.toggle('filter-form--active');
    document.body.classList.toggle('overflow-hidden');
});

filterClose?.addEventListener('click', function() {
  document.querySelector('.filter-form').classList.toggle('filter-form--active');
  document.body.classList.toggle('overflow-hidden');
});

// Filter

submenuToggle.forEach((button) => {

  button.addEventListener('click', function() {

    if (window.innerWidth <= 992) {
      const navItem = button.closest('.nav__item');
      navItem.querySelector('.nav__submenu').slideToggle(300, 'flex');
      navItem.classList.toggle('nav__item--active');

    }

  });

});

window.addEventListener('resize', function() {
  if (window.innerWidth > 992) {
    closeSubMenus(); 
  }
  if (window.innerWidth > 850) {
    document.body.classList.remove('overflow-hidden');
    document.querySelector('.events__filter-form')?.classList.remove('events__filter-form--active');
  }
});

function closeSubMenus() {
  document.querySelectorAll('.nav__submenu').forEach((submenu) => {
    submenu.style.display = '';
  });
  document.querySelectorAll('.nav__item--active').forEach((navItem) => {
    navItem.classList.remove('nav__item--active')
  });
}


function initMentorPreviewSlider() {
  return new Swiper('.mentor-preview__slider', {
    slidesPerView: 1,
    spaceBetween: 10,
    pagination: {
        el: '.mentor-preview__slider-pagination',
        clickable: true,
    },
  });
}

// Function to populate the mentor-preview modal
function fillMentorPreviewModal(card) {
  
  const modal = document.querySelector('.mentor-preview');

  // Copying the elements
  // Клонирование элементов, если они существуют
  const mentorName = card.querySelector('.mentor-card__name');
  const params = card.querySelector('.tags.mentor-card__params');
  const habits = card.querySelector('.tags.mentor-card__habits');
  const description = card.querySelector('.mentor-card__description');
  const specsList = card.querySelector('.tags.mentor-card__specs-list');
  const links = card.querySelector('.mentor-card__links a');

  // Функция для клонирования элемента, если он существует
  const cloneIfExist = (element) => {
    return element ? element.cloneNode(true) : null;
  };

  // Клонирование элементов
  const mentorNameClone = cloneIfExist(mentorName);
  const paramsClone = cloneIfExist(params);
  const habitsClone = cloneIfExist(habits);
  const descriptionClone = cloneIfExist(description);
  const specsListClone = cloneIfExist(specsList);
  const linksClone = cloneIfExist(links);

  // Очистка существующего содержимого модального окна
  const header = modal.querySelector('.mentor-preview__header');
  const body = modal.querySelector('.mentor-preview__body');
  header.innerHTML = '';
  body.innerHTML = '';

  // Добавление клонированных элементов в модальное окно, если они существуют
  if (mentorNameClone) header.appendChild(mentorNameClone);
  if (paramsClone) header.appendChild(paramsClone);
  if (habitsClone) header.appendChild(habitsClone);
  if (descriptionClone) body.appendChild(descriptionClone);
  if (specsListClone) {
    specsListClone.classList.remove('mentor-card--on-modal');
    body.appendChild(specsListClone);
  }
  if (linksClone) body.appendChild(linksClone);

  // Copying images to Swiper
  const swiperWrapper = modal.querySelector('.swiper-wrapper');
  swiperWrapper.innerHTML = '';  // Clear existing slides

  const galleryImages = card.querySelectorAll('.mentor-card__image');
  galleryImages.forEach(image => {
    const swiperSlide = document.createElement('div');
    swiperSlide.classList.add('swiper-slide');
    
    let imgClone;
    if (image.tagName === 'IMG') {
        imgClone = image.cloneNode(true);
        imgClone.classList.remove('mentor-card--on-modal');
    } else if (image.tagName === 'SPAN') {
        imgClone = document.createElement('img');
        imgClone.src = image.dataset.src;
    }

    swiperSlide.appendChild(imgClone);
    swiperWrapper.appendChild(swiperSlide);
  });

  // Destroy existing Swiper instance
  const existingSwiper = modal.querySelector('.mentor-preview__slider').swiper;
  if (existingSwiper) {
      existingSwiper.destroy();
  }

  // Initialize Swiper
  const swiper = initMentorPreviewSlider();
  


}


document.addEventListener('click', function(e) {

  if(e.target.classList.contains('abroad-address-overlay')) {
    document.querySelector('.abroad__address-box--active .abroad__address-box-close').click()
  }

  if(e.target.classList.contains('modal')) {
    const modalToClose = document.querySelector('.modal--active');
    if( modalToClose ) {
      modalToClose.classList.remove('modal--active');
    }
    if( !document.querySelector('.modal--active') ) {
      document.body.classList.remove('overflow-hidden');
    }
  }
});


const searchInputs = document.querySelectorAll('.search-input');
if( searchInputs ) {

    searchInputs.forEach(function(searchInput) {

        searchInput.addEventListener( 'keyup', function(event) {

            const searchText = event.target.value.toLowerCase();
            const listClass = this.dataset.list;
            const items = document.querySelectorAll(listClass + ' li');

            for (let i = 0; i < items.length; i++) {
                const itemText = items[i].textContent.toLowerCase();

                if (itemText.includes(searchText)) {
                    items[i].style.display = 'block';
                } else {
                    items[i].style.display = 'none';
                }
            }

        });

    });



}

navToggle.addEventListener('click', function() {

  header.classList.toggle('header--nav-active');
  this.classList.toggle('header__nav-toggle--active');
  headerMobile.classList.toggle('header__bottom--active');
  document.body.classList.toggle('overflow-hidden');
  
  if( !headerMobile.classList.contains('header__nav-toggle--active') && document.body.classList.contains('overflow-hidden') ) {
    document.body.classList.remove('overflow-hidden');
  }


});

counters.forEach( counter => {
   const animate = () => {
      const value = +counter.dataset.number;
      const data = +counter.innerText;
     
      const time = value / speed;
     if(data < value) {
          counter.innerText = Math.ceil(data + time);
          setTimeout(animate, 1);
        }else{
          counter.innerText = value;
        }
     
   }
   
   animate();
});


abroadAddress.forEach((item) => {
    
  item.addEventListener('click', function() {
    
    const parent = this.closest('.abroad__address-item');

    if( !parent.querySelector('.abroad__address-box') ) return;


    // Удалить существующий оверлей, если он есть
    let overlay = document.querySelector('.abroad-address-overlay');
    if (overlay) {
      overlay.remove();
    }

    // Создать новый оверлей
    overlay = document.createElement('div');
    overlay.classList.add('abroad-address-overlay');
    document.body.appendChild(overlay);

    const openItems = document.querySelectorAll('.abroad__address-box--active');
    openItems.forEach((openItem) => {
      if (openItem.parentElement !== parent) {
        openItem.classList.remove('abroad__address-box--active');
        openItem.previousElementSibling.classList.remove('abroad__address-tag--active');
      }
    });

    parent.querySelector('.abroad__address-box').classList.toggle('abroad__address-box--active');
    this.classList.toggle('abroad__address-tag--active');

  });

});

abroadAddressClose.forEach((item) => {

  item.addEventListener('click', function() {

    this.closest('.abroad__address-item').querySelector('.abroad__address-tag').click();

    let overlay = document.querySelector('.abroad-address-overlay');
    if (overlay) {
      overlay.remove();
    }

  });

});

courseProgramToggleButtons.forEach((item) => {

    item.addEventListener('click', function() {
      
      const container = this.closest('.course__program-items');
      const parent = this.closest('.course__program-item');
      const content = parent.querySelector('.course__program-item-content');
      
      parent.classList.toggle('course__program-item--active');
      parent.querySelector('.course__program-item-content').slideToggle(300);

    });

});

if (viewButtons) {
  viewButtons.forEach((button) => {
    button.addEventListener('click', function() {
      if (this.classList.contains('view-button--active')) return;
      
      const parent = this.closest('.section');
      parent.querySelector('.view-button--active').classList.remove('view-button--active');
      this.classList.add('view-button--active');

      let direction = this.dataset.type;
      let cookiePrefix = this.dataset.cookiePrefix;
      
      if( cookiePrefix ) {
        let cookieName = `${cookiePrefix}ViewPreference`;
        // Установка cookie с выбранным представлением
        setCookie(cookieName, direction, 7);
      }
    
      
      if( this.hasAttribute('data-container-class') ) {

        let containerClass = this.dataset.containerClass;
        let containerDir = containerClass + '--' + direction;
        const container = document.querySelector('.'+containerClass);

        container.classList.forEach(className => {
          if (className.startsWith(containerClass + '--')) {
            container.classList.remove(className);
          }
        });
        container.classList.add(containerDir);

      }

      if( this.classList.contains('events__view-button') ) {
        changeEventsSliderDirection(direction);
      }
      
    });
  });
}

// =====================
// Sliders
// =====================

const introSlider = new Swiper('.intro__slider', {
  slidesPerView: 'auto',
  spaceBetween: 20,
});


const projectsSlider = new Swiper('.projects__slider', {
  slidesPerView: 'auto',
  spaceBetween: 20,
  watchOverflow: true,
  navigation: {
    prevEl: '.projects__nav-button--prev',
    nextEl: '.projects__nav-button--next'
  }
});

const storiesSlider = new Swiper('.stories__slider', {
  slidesPerView: 'auto',
  spaceBetween: 20,
  navigation: {
    prevEl: '.stories__nav-button--prev',
    nextEl: '.stories__nav-button--next'
  },
  breakpoints: {
    576: {
      slidesPerView: 2,
      spaceBetween: 20
    },
    800: {
      slidesPerView: 3,
      spaceBetween: 20
    },
    1170: {
      slidesPerView: 4,
      spaceBetween: 40
    }
  }
});

let eventsSlider = initSwiper('.events__slider:not(.events__slider--vertical)', {
  slidesPerView: 'auto',
  spaceBetween: 30,
  watchOverflow: true,
  navigation: {
    prevEl: '.events__nav-button--prev',
    nextEl: '.events__nav-button--next'
  },
});

const gallerySlider = new Swiper('.gallery__slider', {
  spaceBetween: 1,
  slidesPerView: 1,
  centeredSlides: true,
  roundLengths: true,
  initialSlide: 1,
  loopAdditionalSlides: 30,
  navigation: {
    prevEl: '.gallery__nav-button--prev',
    nextEl: '.gallery__nav-button--next'
  },
  on: {
    slideChange: function(el) {
        let currentSlide = el.slides[el.activeIndex];
        let caption = currentSlide.dataset.caption;
        let captionElement = el.el.closest('section')?.querySelector('.gallery__caption');
        if( caption && captionElement ) {
          captionElement.textContent = caption;
        }
    }
  }
});

const teamSlider = new Swiper('.team__slider', {
  slidesPerView: 'auto',
  spaceBetween: 22,
  navigation: {
    prevEl: '.team__nav-button--prev',
    nextEl: '.team__nav-button--next'
  },
  scrollbar: {
    el: ".team__scrollbar",
  },
  breakpoints: {
    850: {
      slidesPerView: 3,
    },
    1170: {
      slidesPerView: 4,
    }
  }
});

const ecoSystemSlider = new Swiper('.ecosystem__slider', {
  slidesPerView: 'auto',
  spaceBetween: 22,

  breakpoints: {
    850: {
      slidesPerView: 3,
    },
    992: {
      slidesPerView: 4,
    },
    1200: {
      slidesPerView: 5,
    }
  }
});

const contactsSlider = new Swiper('.contacts__slider', {
  spaceBetween: 15,
  slidesPerView: 1,
  loopAdditionalSlides: 30,
  pagination: {
    el: '.contacts__slider-pagination',
    clickable: true
  }
});

const reviewsSlider = new Swiper('.reviews__slider', {
  slidesPerView: 1,
  spaceBetween: 40,
  navigation: {
    prevEl: '.reviews__nav-button--prev',
    nextEl: '.reviews__nav-button--next'
  },
  breakpoints: {
    1366: {
      slidesPerView: 2,
    }
  },
});


const testimonialsSlider = new Swiper('.testimonials__slider', {
  slidesPerView: 'auto',
  spaceBetween: 30,
});


const reportsSlider = new Swiper('.reports__card-slider', {
  slidesPerView: 'auto',
  spaceBetween: 10,
  pagination: {
      el: '.reports__card-slider-pagination',
      clickable: true,
  },
});

function changeEventsSliderDirection(direction) {
  
  if (direction == 'horizontal') {
    initSwiper('.events__slider', {
      slidesPerView: 'auto',
      spaceBetween: 30,
      watchOverflow: true,
      navigation: {
        prevEl: '.events__nav-button--prev',
        nextEl: '.events__nav-button--next'
      },
    }, 'events__slider--destroyed');

  } else {

    destroySwiper('.events__slider', 'events__slider--destroyed');
    
  }

}


function destroySwiper(selectorOrSwiper, destroyedClass = '') {
  let slider;
  if (typeof selectorOrSwiper === 'string') {
    slider = document.querySelector(selectorOrSwiper);
  } else {
    slider = selectorOrSwiper;
  }

  if (slider !== null) {
    const swiperInstance = slider.swiper;
    if (swiperInstance) {
      swiperInstance.destroy(); // Уничтожить Swiper, если он существует
      if( destroyedClass ) {
        document.querySelector(selectorOrSwiper).classList.add(destroyedClass)
      }

    }
  }
}

// Quiz
function initializeQuiz() {

  const quiz = document.querySelector('.quiz__form')

  if( !quiz ) return;

  const radioButtons = quiz.querySelectorAll('input[type=radio]');
  const quizButtons = quiz.querySelectorAll('.quiz__step-button');

  createDots(quiz);


  radioButtons.forEach((radioButton) => {

    radioButton.addEventListener('change', function() {

      const currentStep = this.closest('.quiz__step');
      const nextButton = currentStep.querySelector('.quiz__step-button--next');

      const anyChecked = Array.from(radioButtons).some(button => button.checked);
      nextButton.disabled = !anyChecked;

    });
  });


  quizButtons.forEach((quizButton) => {

    quizButton.addEventListener('click', function() {

      handleQuizButtonClick(this);

    });
  });


  function handleQuizButtonClick(clickedButton) {

    
    const isNext = clickedButton.classList.contains('quiz__step-button--next') ? true : false;
    const currentStep = clickedButton.closest('.quiz__step');
    const nextStep = isNext ? currentStep.nextElementSibling : currentStep.previousElementSibling;

    if (nextStep) {
      
      currentStep.style.display = "none";
      nextStep.style.display = "flex";

      currentStep.classList.remove('quiz__step--current');
      nextStep.classList.add('quiz__step--current');

      updateDots(quiz);


    }

  }

  function createDots(quiz) {

    const dots = quiz.querySelector('.quiz__dots');
    const quizLength = quiz.querySelectorAll('.quiz__step').length;

    for(let i = 0; i < quizLength; i++) {
      
      const span = document.createElement('span');
      span.classList.add('quiz__dot');
      if (i === 0) {
        span.classList.add('quiz__dot--active');
      }
      dots.appendChild(span);

    }

  }

  function updateDots(quiz) {
    const quizSteps = quiz.querySelectorAll('.quiz__step');
    const dots = quiz.querySelector('.quiz__dots');

    const allDots = dots.querySelectorAll('.quiz__dot');
    allDots.forEach(dot => {
        dot.classList.remove('quiz__dot--active');
    });

    let foundCurrentStep = false; // Флаг для определения текущего шага

    for (let i = 0; i < quizSteps.length; i++) {
        const step = quizSteps[i];
        const dot = dots.children[i];

        // Если текущий шаг найден, устанавливаем активность для всех точек до текущего шага
        if (step.classList.contains('quiz__step--current')) {
            foundCurrentStep = true;
            dot.classList.add('quiz__dot--active');
        } else if (!foundCurrentStep) {
            dot.classList.add('quiz__dot--active');
        }
    }
}


}

// Faq init
function faqInit() {
  const faqItems = document?.querySelectorAll('.faq__item-toggle');

  faqItems.forEach((item) => {
    item.addEventListener('click', function(e) {
  
      e.preventDefault();
  
      const container = this.closest('.faq');
      const otherItems = container.querySelectorAll('.faq__item--active');
      const parent = this.closest('.faq__item');
      const content = parent.querySelector('.faq__item-content');
      
      parent.classList.toggle('faq__item--active');
      parent.querySelector('.faq__item-content').slideToggle(300);
  
      if( otherItems ) {
        otherItems.forEach(function(elem) {
          elem.querySelector('.faq__item-content').slideToggle(300);
          elem.classList.remove('faq__item--active');
        });
      }
  
  
    });
  });
}

// Tabs
function tabsInit() {

  const tabButtons = document.querySelectorAll('.tab__button');

  tabButtons?.forEach(function(button) {

    button.addEventListener('click', function() {
  
      if( this.classList.contains('tab__button--active') ) return;
  
      const tab = this.closest('.tab');
      const contentID = this.dataset.content;
      const activeContent = tab.querySelector('.tab__content--active');
      const activeButton = tab.querySelector('.tab__button--active');
      const contentToActive = document.getElementById(contentID);
      
  
      if( contentToActive ) {
  
        activeContent.classList.remove('tab__content--active');
        activeButton.classList.remove('tab__button--active');
  
        this.classList.add('tab__button--active');
        contentToActive.classList.add('tab__content--active');
  
      }
  
    });
  });
}

// Modal
function modalInit() {

  const openModal = document.querySelectorAll('.open-modal');
  const modalClose = document.querySelectorAll('.modal__close');

  if( openModal ) {

    openModal.forEach(function(button) {
      button.addEventListener('click', function(e) {
        console.log(button)
        e.preventDefault();
        const modalId = button.dataset.id;
    
        const modal = document.getElementById(modalId);
  
        if( modal ) {
  
          document.body.classList.add('overflow-hidden');
          modal.classList.add('modal--active');
  
          if( button.dataset.id == 'mentor-preview' ) {
            const card = button.closest('.mentor-card');
            if (card) {
                fillMentorPreviewModal(card);
            }
          }
  
        }
  
      });
    });
  
  }
  
  if( modalClose ) {
  
    modalClose.forEach(function(button) {
      button.addEventListener('click', function() {
        this.closest('.modal').classList.remove('modal--active');
        if( !document.querySelector('.modal--active') ) {
          document.body.classList.remove('overflow-hidden');
        }
      });
    });
  
  }

}

//  Range slider
function rangeSliderInit() {

  const rangeSliders = document.querySelectorAll('.range');

  rangeSliders.forEach((item) => {

    const sliderTrack = item.querySelector('.range__track');
    const sliderLeft = item.querySelector('.range__input--left');
    const sliderRight = item.querySelector('.range__input--right');
    const valueLeft = item.querySelector('.range__value--left span');
    const valueRight = item.querySelector('.range__value--right span');
    let minGap = 0;
    const sliderMaxValue = sliderLeft.max;
  
    function updateSlider(slider, oppositeSlider, isLeft) {
        if (isLeft) {
            if (parseInt(oppositeSlider.value) - parseInt(slider.value) <= minGap) {
                slider.value = parseInt(oppositeSlider.value) - minGap;
            }
            valueLeft.textContent = slider.value;
        } else {
            if (parseInt(slider.value) - parseInt(oppositeSlider.value) <= minGap) {
                slider.value = parseInt(oppositeSlider.value) + minGap;
            }
            valueRight.textContent = slider.value;
        }
        fillColor(sliderLeft, sliderRight, sliderTrack, sliderMaxValue);
    }
  
    sliderLeft.addEventListener('input', function() {
        updateSlider(this, sliderRight, true);
    });
  
    sliderRight.addEventListener('input', function() {
        updateSlider(this, sliderLeft, false);
    });
  
    // Initialize the displayed values
    valueLeft.textContent = sliderLeft.value;
    valueRight.textContent = sliderRight.value;
  });

}


function fillColor(sliderOne, sliderTwo, track, sliderMaxValue) {
  const percent1 = (sliderOne.value / sliderMaxValue) * 100;
  const percent2 = (sliderTwo.value / sliderMaxValue) * 100;
  track.style.background = `linear-gradient(to right, #dadae5 ${percent1}% , #3264fe ${percent1}% , #3264fe ${percent2}%, #dadae5 ${percent2}%)`;
}
//  Range slider

// Custom select
function customSelect() {
  const items = document.querySelectorAll('.select');

  if( !items ) return;

  items.forEach((item) => {

    const select = item.querySelector('select');
    const options = item.querySelectorAll('option');
    if( !options ) return;

    const current = document.createElement('div');
    current.classList.add('select__current');

    const ul = document.createElement('ul');
    ul.classList.add('select__list');

    options.forEach((option) => {
      
      const li = document.createElement('li');
      li.textContent = option.textContent;
      li.setAttribute('data-value', option.getAttribute('value'));
      li.classList.add('select__item');

      if( option.getAttribute('value') == select.value ) {
        li.classList.add('select__item--current');
        current.textContent = option.textContent;
      }
      
      ul.appendChild(li);

    });

    item.appendChild(current);
    item.appendChild(ul);

    select.addEventListener('change', function() {

      let value = !this.value ? '""' : this.value;
      let curr = ul.querySelector('li[data-value='+value+']');

      if( curr ) {

        ul.querySelector('.select__item--current').classList.remove('select__item--current');
        curr.classList.add('select__item--current');
        current.textContent = curr.textContent;
      }

      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server
      // Here is you can send data to the server


    });

    current.addEventListener('click', function() {
      this.closest('.select').classList.toggle('select--active');
    });

    const listItems = ul.querySelectorAll('li');

    listItems.forEach((item) => {

      item.addEventListener('click', function() {
        
        if( this.classList.contains('select__item--current') ) return;

        ul.querySelector('.select__item--current').classList.remove('select__item--current');
        this.classList.add('select__item--current');
        select.value = this.dataset.value;
        current.textContent = this.textContent;

        current.closest('.select--active').classList.remove('select--active');

        select.dispatchEvent(new Event('change'));

      });

    });

    // Close dropdonw when clicked outside
    document.addEventListener('click', function(e) {
      
      if(!item.contains(e.target)) {
        item.classList.remove('select--active');
      }
    });


  });

}

// Функция для инициализации слайдера
function initSwiper(className, options, destroyedClass = '') {

  if( destroyedClass ) {
    document.querySelector(className).classList.remove(destroyedClass)
  }

  return new Swiper(className, options);
  

}

// Функция для установки cookie
function setCookie(name, value, days) {
  let expires = "";
  if (days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    expires = "; expires=" + date.toUTCString();
  }
  document.cookie = name + "=" + (value || "") + expires + "; path=/";
}

// Функция для получения значения cookie
function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}



// Slide Toggle Vanilla JS
HTMLElement.prototype.slideToggle = function(duration, displayType) {
  if (this.clientHeight === 0) {
    _s(this, duration, true, displayType);
  } else {
    _s(this, duration, false, displayType);
  }
};

function _s(el, duration, isDown, displayType) {
  
  if (typeof duration === 'undefined') duration = 400;
  if (typeof isDown === 'undefined') isDown = false;
  if (typeof displayType === 'undefined') displayType = 'block';

  el.style.overflow = "hidden";
  if (isDown) el.style.display = displayType;

  var elStyles        = window.getComputedStyle(el);

  var elHeight        = parseFloat(elStyles.getPropertyValue('height'));
  var elPaddingTop    = parseFloat(elStyles.getPropertyValue('padding-top'));
  var elPaddingBottom = parseFloat(elStyles.getPropertyValue('padding-bottom'));
  var elMarginTop     = parseFloat(elStyles.getPropertyValue('margin-top'));
  var elMarginBottom  = parseFloat(elStyles.getPropertyValue('margin-bottom'));

  var stepHeight        = elHeight        / duration;
  var stepPaddingTop    = elPaddingTop    / duration;
  var stepPaddingBottom = elPaddingBottom / duration;
  var stepMarginTop     = elMarginTop     / duration;
  var stepMarginBottom  = elMarginBottom  / duration;

  var start;

  function step(timestamp) {

    if (start === undefined) start = timestamp;

    var elapsed = timestamp - start;

    if (isDown) {
      el.style.height        = (stepHeight        * elapsed) + "px";
      el.style.paddingTop    = (stepPaddingTop    * elapsed) + "px";
      el.style.paddingBottom = (stepPaddingBottom * elapsed) + "px";
      el.style.marginTop     = (stepMarginTop     * elapsed) + "px";
      el.style.marginBottom  = (stepMarginBottom  * elapsed) + "px";
    } else {
      el.style.height        = elHeight        - (stepHeight        * elapsed) + "px";
      el.style.paddingTop    = elPaddingTop    - (stepPaddingTop    * elapsed) + "px";
      el.style.paddingBottom = elPaddingBottom - (stepPaddingBottom * elapsed) + "px";
      el.style.marginTop     = elMarginTop     - (stepMarginTop     * elapsed) + "px";
      el.style.marginBottom  = elMarginBottom  - (stepMarginBottom  * elapsed) + "px";
    }

    if (elapsed >= duration) {
      el.style.height        = "";
      el.style.paddingTop    = "";
      el.style.paddingBottom = "";
      el.style.marginTop     = "";
      el.style.marginBottom  = "";
      el.style.overflow      = "";
      if (!isDown) el.style.display = "none";
    } else {
      window.requestAnimationFrame(step);
    }
  }

  window.requestAnimationFrame(step);
}
